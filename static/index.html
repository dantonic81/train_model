<!DOCTYPE html>
<html>
<head>
    <title>MNIST Digit Recognizer</title>
</head>
<body>
<canvas id="canvas" width="280" height="280" style="border:1px solid #000"></canvas>
<br>
<button onclick="predict()">Predict</button>
<p id="result"></p>
<script>
let canvas = document.getElementById("canvas");
let ctx = canvas.getContext("2d");
ctx.fillStyle = "black";
let drawing = false;
canvas.addEventListener("mousedown", () => drawing = true);
canvas.addEventListener("mouseup", () => drawing = false);
canvas.addEventListener("mousemove", e => {
  if (!drawing) return;
  let rect = canvas.getBoundingClientRect();
  let x = e.clientX - rect.left;
  let y = e.clientY - rect.top;
  ctx.fillRect(x, y, 10, 10);
});
function predict() {
    let imageData = ctx.getImageData(0, 0, 280, 280);
    let pixels = new Array(28*28).fill(0);
    for (let y = 0; y < 28; y++) {
        for (let x = 0; x < 28; x++) {
            let sum = 0;
            for (let dy = 0; dy < 10; dy++) {
                for (let dx = 0; dx < 10; dx++) {
                    let px = ((y*10 + dy) * 280 + (x*10 + dx)) * 4;
                    sum += imageData.data[px];
                }
            }
            pixels[y*28 + x] = 255 - sum / 100;
        }
    }
    fetch("/predict", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({pixels})
    })
    .then(r => r.json())
    .then(data => document.getElementById("result").innerText = "Predicted: " + data.prediction);
}
</script>
</body>
</html>
